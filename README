Hagfish

Copyright 2010 Mark Fiers

Creative use of dotplots. 

Hagfish can be used for multiple purposes

- as a quality control measure for assembled sequences
- to assess how & where a resequencing dataset differs from 
  a reference sequence
- as a comparative analysis tool to compare to resequenced 
  genomes

Using hagfish requires you to have a reference genome and a
resequencing, paired end, dataset. Hagfish becomes more powerfull if
the paired ends are at least one or two kb apart.

PREREQS

You'll need hagfish, python2.6, matplotlib & numpy.

SCRIPTS

All scripts will give you some information on how to execute if you
run them with '--help'. Hagfish contains the following scripts:

hagfish_extract - first extraction of data for hagfish from the input
    BAM files.

hagfish_coverage_combined - combine the initial files (as generated by
    hagfish_extract) into combined hagfish files

hagfish_cplot - generate a stacked pseudo-coverage plot 

hagfish_blockplot - generate a 'blockplot' - badly named - generates a
    pseudo-color plot of the hagfish error score showing the quality of
    the alingment in that specific position


PROCEDURE

Before using Hagfish you'll need to align the read pairs against the
genome. Note that you need a paired alignment & the readpairs should
not be restricted (too much) in the distance that they align from each
other.

I use bowtie to align readpairs, usually with a minimal insert size of
zero and a max insert size of ten to a hundred times the expected
insert size. Furthermore, I ask bowtie to return *all* readpairs in
the top stratum. Bowtie needs to output its results in SAM format,
that must be converted to BAM afterwards (samtools).

Once you have a set of BAM files (one per library/lane) you can start
using hagfish. It is probably smartest to use hagfish in a separate
directory as it creates quite a few hagfish specific
files/directories. Hagfish depends on the presence of these
files/directories in exactly the correct position - so all scripts
need to be executed with this directory as the cwd.

The first step is to extract the hagfish coverage plots
per library/lane. This is done using hagfish_extract:

    hagfish_extract ../alignment_files/*.bam

or:

    hagfish_extract ../alignment_files/lib1.bam &
    hagfish_extract ../alignment_files/lib1.bam &
    hagfish_extract ../alignment_files/lib1.bam &

if you want to extract multiple files in parallel (which is possible).

Hagfish will generate a number of directories. Once all initial
extraction steps have finished, the output needs to be combined into
one overall file (per input sequence) using:

    hagfish_coverage_combine

without any parameters, but in the hagfish working directory.

All these steps can take a while to process, depending on the amount
of input data & the number of scaffolds in the reference sequence.

Once all data is process you can start generating coverage plots using

    hagfish_cplot <SEQID>

Also try:

    hagfish_cplot --help

to see what parameters there are to play with.


LICENCE

Released under the GPL - see COPYING for more details.

